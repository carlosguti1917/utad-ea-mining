import json
from json import JSONDecodeError

#str_dump = json.dumps("[{'timeMillis': 3, 'message': 'Choosing route between 1138 possible alternatives', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Found matching route: apiplatform.sensedia.com/sandbox/demo-erp/clientes/ => without destination', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing API Interceptors', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing Log Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Request log', 'data': {'log': {'headers': 'host: apiplatform.sensedia.com\nuser-agent: Retool/2.0 (+https://docs.tryretool.com/docs/apis)\nx-retool-forwarded-for: 189.62.151.32\naccept: */*\naccept-encoding: gzip,deflate\nx-datadog-trace-id: 7688046275286039197\nx-datadog-parent-id: 6753088087945052617\nx-datadog-sampled: 1\nx-datadog-sampling-priority: 0\nx-forwarded-for: 52.175.251.223\nx-forwarded-proto: https\nx-envoy-external-address: 52.175.251.223\nx-request-id: 2936b22d-a46d-4428-b997-f208fc15a45a\ncontent-length: 0', 'method': 'GET', 'execution-point': 'FIRST', 'body': '', 'url': 'http://apiplatform.sensedia.com/sandbox/demo-erp/clientes'}, 'type': 'LOG'}, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing MockInterceptor Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing API Interceptors', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing Log Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Response log', 'data': {'log': {'headers': 'content-type: application/json', 'execution-point': 'SECOND', 'body': '[\n\t{\n\t\t  "id":\'1\',\n\t\t  "name":"JOAO",\n\t\t  "email":"joao@email.com",\n\t\t  "phone":"123456"\n\t},\n\t{\n\t\t  "id":\'2\',\n\t\t  "name":"MARIA",\n\t\t  "email":"maria@email.com",\n\t\t  "phone":"789456"\n\t},\n\t{\n\t\t  "id":\'3\',\n\t\t  "name":"PEDRO",\n\t\t  "email":"pedro@email.com",\n\t\t  "phone":"456258"\n\t}\n]', 'status': 200}, 'type': 'LOG'}, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Returning response to client', 'data': None, 'encryptContent': False}, {'timeMillis': 5, 'message': 'Saving trace', 'data': None, 'encryptContent': False}]")
#str_example_1 = "[{'timeMillis': 3, 'message': 'Choosing route between 1138 possible alternatives', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Found matching route: apiplatform.sensedia.com/sandbox/demo-erp/clientes/ => without destination', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing API Interceptors', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing Log Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Request log', 'data': {'log': {'headers': 'host: apiplatform.sensedia.com\nuser-agent: Retool/2.0 (+https://docs.tryretool.com/docs/apis)\nx-retool-forwarded-for: 189.62.151.32\naccept: */*\naccept-encoding: gzip,deflate\nx-datadog-trace-id: 7688046275286039197\nx-datadog-parent-id: 6753088087945052617\nx-datadog-sampled: 1\nx-datadog-sampling-priority: 0\nx-forwarded-for: 52.175.251.223\nx-forwarded-proto: https\nx-envoy-external-address: 52.175.251.223\nx-request-id: 2936b22d-a46d-4428-b997-f208fc15a45a\ncontent-length: 0', 'method': 'GET', 'execution-point': 'FIRST', 'body': '', 'url': 'http://apiplatform.sensedia.com/sandbox/demo-erp/clientes'}, 'type': 'LOG'}, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing MockInterceptor Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing API Interceptors', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Executing Log Interceptor', 'data': None, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Response log', 'data': {'log': {'headers': 'content-type: application/json', 'execution-point': 'SECOND', 'body': '[\n\t{\n\t\t  "id":\'1\',\n\t\t  "name":"JOAO",\n\t\t  "email":"joao@email.com",\n\t\t  "phone":"123456"\n\t},\n\t{\n\t\t  "id":\'2\',\n\t\t  "name":"MARIA",\n\t\t  "email":"maria@email.com",\n\t\t  "phone":"789456"\n\t},\n\t{\n\t\t  "id":\'3\',\n\t\t  "name":"PEDRO",\n\t\t  "email":"pedro@email.com",\n\t\t  "phone":"456258"\n\t}\n]', 'status': 200}, 'type': 'LOG'}, 'encryptContent': False}, {'timeMillis': 4, 'message': 'Returning response to client', 'data': None, 'encryptContent': False}, {'timeMillis': 5, 'message': 'Saving trace', 'data': None, 'encryptContent': False}]"
str_exemple_0 = """"[{"timeMillis":3,"message":"Choosing route between 1138 possible alternatives","data":null,"encryptContent":false},{"timeMillis":4,"message":"Found matching route: apiplatform.sensedia.com/sandbox/demo-erp/clientes/ => without destination","data":null,"encryptContent":false},{"timeMillis":4,"message":"Executing API Interceptors","data":null,"encryptContent":false},{"timeMillis":4,"message":"Executing Log Interceptor","data":null,"encryptContent":false},{"timeMillis":4,"message":"Request log","data":{"log":{"headers":"host: apiplatform.sensedia.com\nuser-agent: Retool/2.0 (+https://docs.tryretool.com/docs/apis)\nx-retool-forwarded-for: 189.62.151.32\naccept: */*\naccept-encoding: gzip,deflate\nx-datadog-trace-id: 7688046275286039197\nx-datadog-parent-id: 6753088087945052617\nx-datadog-sampled: 1\nx-datadog-sampling-priority: 0\nx-forwarded-for: 52.175.251.223\nx-forwarded-proto: https\nx-envoy-external-address: 52.175.251.223\nx-request-id: 2936b22d-a46d-4428-b997-f208fc15a45a\ncontent-length: 0","method":"GET","execution-point":"FIRST","body":"","url":"http://apiplatform.sensedia.com/sandbox/demo-erp/clientes"},"type":"LOG"},"encryptContent":false},{"timeMillis":4,"message":"Executing MockInterceptor Interceptor","data":null,"encryptContent":false},{"timeMillis":4,"message":"Executing API Interceptors","data":null,"encryptContent":false},{"timeMillis":4,"message":"Executing Log Interceptor","data":null,"encryptContent":false},{"timeMillis":4,"message":"Response log","data":{"log":{"headers":"content-type: application/json","execution-point":"SECOND","body":"[\n\t{\n\t\t  \"id\":'1',\n\t\t  \"name\":\"JOAO\",\n\t\t  \"email\":\"joao@email.com\",\n\t\t  \"phone\":\"123456\"\n\t},\n\t{\n\t\t  \"id\":'2',\n\t\t  \"name\":\"MARIA\",\n\t\t  \"email\":\"maria@email.com\",\n\t\t  \"phone\":\"789456\"\n\t},\n\t{\n\t\t  \"id\":'3',\n\t\t  \"name\":\"PEDRO\",\n\t\t  \"email\":\"pedro@email.com\",\n\t\t  \"phone\":\"456258\"\n\t}\n]","status":200},"type":"LOG"},"encryptContent":false},{"timeMillis":4,"message":"Returning response to client","data":null,"encryptContent":false},{"timeMillis":5,"message":"Saving trace","data":null,"encryptContent":false}]"""

#str_example_3 = " {   "_id": {     "$oid": "62b8cea41a763041ec85aabd"   },   "apiId": 1932,   "revisionId": 20700,   "resourceId": 20701,   "operationId": 20702,   "apiComponentType": "OPERATION",   "clientId": "",   "appName": "",   "appDeveloper": null,   "accessToken": "",   "accessTokenOwner": "",   "receivedOn": {     "$numberLong": "1656089758889"   },   "receivedFromAddress": "52.175.251.223",   "durationMillis": null,   "resultStatus": 200,   "method": "GET",   "url": null,   "receivedOnDate": "2022/06/24 16:55:58 +0000",   "insertedOnDate": "2022/06/24 16:56:04 +0000",   "cache": null,   "responsePayload": 279,   "requestPayload": 0,   "completeUrl": null,   "yearMonth": "20226",   "typeStatus": "success",   "typeError": null,   "apiName": "DEMO1 Mock ERP [Nao Excluir]",   "resourceName": "clientes",   "operationName": "DEMO1 Mock ERP [Nao Excluir] GET /clientes",   "billing": false,   "billingData": null,   "environmentId": 2,   "environmentName": "Sandbox",   "redis": false,   "gatewayDurationMillis": 4,   "transactionID": "",   "requestID": "43d8b6c5-cf83-4cf4-a00c-87e2ad647da8",   "targetResultStatus": null,   "targetDurationMillis": 0,   "id": "D8KkloEBGjj1AzoTb38x",   "callDate": {     "$numberLong": "1656089758889"   },   "callerAddress": "52.175.251.223",   "uri": "https://apiplatform.sensedia.com/sandbox/demo-erp/clientes",   "duration": 4,   "requestHeaders": "host: apiplatform.sensedia.com\nuser-agent: Retool/2.0 (+https://docs.tryretool.com/docs/apis)\nx-retool-forwarded-for: 189.62.151.32\naccept: */*\naccept-encoding: gzip,deflate\nx-datadog-trace-id: 7688046275286039197\nx-datadog-parent-id: 6753088087945052617\nx-datadog-sampled: 1\nx-datadog-sampling-priority: 0\nx-forwarded-for: 52.175.251.223\nx-forwarded-proto: https\nx-envoy-external-address: 52.175.251.223\nx-request-id: 2936b22d-a46d-4428-b997-f208fc15a45a\ncontent-length: 0",   "responseHeaders": "content-type: application/json",   "trace": "[{\"timeMillis\":3,\"message\":\"Choosing route between 1138 possible alternatives\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Found matching route: apiplatform.sensedia.com/sandbox/demo-erp/clientes/ => without destination\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Executing API Interceptors\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Executing Log Interceptor\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Request log\",\"data\":{\"log\":{\"headers\":\"host: apiplatform.sensedia.com\\nuser-agent: Retool/2.0 (+https://docs.tryretool.com/docs/apis)\\nx-retool-forwarded-for: 189.62.151.32\\naccept: */*\\naccept-encoding: gzip,deflate\\nx-datadog-trace-id: 7688046275286039197\\nx-datadog-parent-id: 6753088087945052617\\nx-datadog-sampled: 1\\nx-datadog-sampling-priority: 0\\nx-forwarded-for: 52.175.251.223\\nx-forwarded-proto: https\\nx-envoy-external-address: 52.175.251.223\\nx-request-id: 2936b22d-a46d-4428-b997-f208fc15a45a\\ncontent-length: 0\",\"method\":\"GET\",\"execution-point\":\"FIRST\",\"body\":\"\",\"url\":\"http://apiplatform.sensedia.com/sandbox/demo-erp/clientes\"},\"type\":\"LOG\"},\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Executing MockInterceptor Interceptor\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Executing API Interceptors\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Executing Log Interceptor\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Response log\",\"data\":{\"log\":{\"headers\":\"content-type: application/json\",\"execution-point\":\"SECOND\",\"body\":\"[\\n\\t{\\n\\t\\t  \\\"id\\\":'1',\\n\\t\\t  \\\"name\\\":\\\"JOAO\\\",\\n\\t\\t  \\\"email\\\":\\\"joao@email.com\\\",\\n\\t\\t  \\\"phone\\\":\\\"123456\\\"\\n\\t},\\n\\t{\\n\\t\\t  \\\"id\\\":'2',\\n\\t\\t  \\\"name\\\":\\\"MARIA\\\",\\n\\t\\t  \\\"email\\\":\\\"maria@email.com\\\",\\n\\t\\t  \\\"phone\\\":\\\"789456\\\"\\n\\t},\\n\\t{\\n\\t\\t  \\\"id\\\":'3',\\n\\t\\t  \\\"name\\\":\\\"PEDRO\\\",\\n\\t\\t  \\\"email\\\":\\\"pedro@email.com\\\",\\n\\t\\t  \\\"phone\\\":\\\"456258\\\"\\n\\t}\\n]\",\"status\":200},\"type\":\"LOG\"},\"encryptContent\":false},{\"timeMillis\":4,\"message\":\"Returning response to client\",\"data\":null,\"encryptContent\":false},{\"timeMillis\":5,\"message\":\"Saving trace\",\"data\":null,\"encryptContent\":false}]",   "baseUrl": null,   "additionalData": "",   "httpStatus": "200",   "authOwner": "",   "appToken": "" } "

log_body = None
json_body = None
try:
    json_body = json.loads(str_exemple_0)
    json_dump = json.dump(json_body)
    print(json_dump)
    for trace_log in json_body:
        if trace_log["message"] == "Response log" and len(trace_log["data"]["log"]["body"]) > 0:
            log_body = json.loads(trace_log["data"]["log"]["body"])
            break
    print("log_body", log_body)
except JSONDecodeError as excinfo:
    print("Não foi possivel converter para json: " | {trace_log} | {excinfo})
    print("in module", __name__)
except Exception as error:
    print('Ocorreu problema {} '.format(error.__class__))
    print("mensagem", str(error))
    print("in module", __name__)
